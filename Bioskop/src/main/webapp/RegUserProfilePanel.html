<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>My Profile</title>
<link href="css/Adminpanel.css" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"> </script>

<style>
	.panel {
    background-color: lightblue;
}
</style>

</head>
<body>

<div id="mySidenav" class="sidenav">
	
  	<a href="#" onclick="profile()">Profile</a>
  	<hr>
  	<a href="#"  onclick="cinemas()">Cinemas</a>
  	<hr>
  	<a href="#"  onclick="theaters()">Theaters</a>
  	<hr>
  	<a href="#"  onclick="friends()">Friends</a>
  	<hr>
  	<a href="#" onclick="friendRequests()">Friend Requests</a>
  	<hr>
  	<a href="#" onclick="">Reservations</a>
	<hr>
</div>

<!-- Add all page content inside this div if you want the side nav to push page content to the right (not used if you only want the sidenav to sit on top of the page -->
<div id="main">
	<div class="jumbotron" id="jumbotron" style="margin-left:200px;margin-right:0px;padding-left:0px;padding-top:-50px;margin-top:0px;">
		<div class="container" style="margin-top: 10px;" id="bodyRegUser">
  		</div>
	</div>
</div>



</body>

<script src="uploadImage.js"></script>
<script>

function filter() {
	var $panels = $('.panel');
	$('#search-input').on('keyup', function() {
	    var val = this.value.toLowerCase();

	    $panels.show().filter(function() {
	        var panelTitleText = $(this).find('.panel-title').text().toLowerCase();
	        return panelTitleText.indexOf(val) < 0;
	    }).hide();
	});	
}



function filter2() {
	var $panels = $('.panel');
	$('#search-input').on('keyup', function() {
	    var val = this.value.toLowerCase();
	    
	    // show
	    $.each($panels, function(i, pan){
	    	$(this).parent().show();
	    });
	    
	    // filter
	    var tempPanels = $panels.filter(function() {
	        var panelTitleText = $(this).find('.panel-title').text().toLowerCase();
	        return panelTitleText.indexOf(val) < 0;     
	    });
	    
	    
	    // hide
	    $.each(tempPanels, function(i, panel){
	    	$(this).parent().hide();
	    });
	});	
}


function profile(){
	$("#bodyRegUser").empty();
	$.ajax({
		contentType : 'application/json',
		dataType : 'json',
		type : 'GET',
		success : function(user){
			$.get("asd.html", function( profile ) {
				  $("#bodyRegUser").append(profile);
				  tableIndex = 1;
				  $("#profileImage").attr('src', 'images/' + user.profilePicture);
				  $("#profileLastname").val(user.lastName);
				  $("#profileFirstname").val(user.firstName);
				  $("#profileUsername").val(user.username);
				  $("#profileEmail").val(user.email);
				  $("#profileCity").val(user.address.city);
				  $("#profileStreet").val(user.address.street);
				  $("#profilePassword").val(user.password);
				  $("#userInfo").html(user.firstName + " " + user.lastName);
				});
			
		},
		processData: false,
		url : '/api/profile'
	});
}


function friends() {
	$("#bodyRegUser").empty();
	var body = '<div class = "row">';
	body += '<div class="form-group"><label for="usr">Please enter friend\'s username:</label><input type="text" placeholder="Username" class="form-control" id="friend-username"></div>'
	body += '<button id="add-friend-btn" type="button" class="btn btn-primary" onclick="sendRequest()" >Send Friend Request</button>';
	body += '<hr>';
	body += '<input class="form-control" id="search-input" type="text" onkeyup="filter2()" placeholder="Search Friends...">'
	body += '<hr>';
	body += '';
	body += '<div class="col-sm-12 col-md-12" style="background-color:white;border-radius:6px;padding:15px;margin-right:15px;">';
	body += '<div class="col-sm-12 col-md-12" id="friends-col" style="margin-top:20px;">';
	
	$.ajax({
		contentType : 'application/json',
		url : '/api/getFriends',
		dataType : 'json',
		type : 'GET',
		success : function(friends){
			friends.forEach(function(friend){

					body += '<div class="col-md-4">';
					body +=	  '<div class="panel panel-info">';
					body +=	     '<div class="panel-heading">';
					body +=	         '<h3 class="panel-title">' + friend.firstName + ' ' + friend.lastName + '</h3>';
					body +=      '</div>';
					body +=      '<div class="panel-body">';
					body +=	        '<img class="img-responsive" style="height:50px;" src=images/' + friend.profilePicture + '>';
					body +=	        '<p style="margin-top:15px;word-wrap: break-word;">' + friend.email + '</p>';
					body +=	        '<p> <small>username: </small>' + friend.username + '</p>';
					body +=	     '</div>';
					body +=      '<div class="panel-footer">';
					body +=	        '<button class="btn btn-primary" onclick="removeFriend(' + friend.id + ')">Remove Friend</button>';
					body +=      '</div>'
					body +=   '</div>'
					body += '</div>'
			});

			body += '</div>';
			body += '</div>';
			body += '</div>';
			body += '<hr>';
			$("#bodyRegUser").append(body);
			
		},
		processData: false
		
	});
	
}


function sendRequest() {
	
	
	$.ajax({
		contentType : 'application/json',
		url : '/api/friendships/addFriendship/' + $("#friend-username").val(),
		dataType : 'json',
		type : 'POST',
		success : function() {
			alert('Friend request has been successfully sent!');
		},
		error : function() {
			alert('ERROR sending friend request!');
		},
		processData : false
	});
	
}

function friendRequests() {
	$("#bodyRegUser").empty();
	var body = '<div class = "row">';
	body += '';
	body += '<div class="col-sm-12 col-md-12" style="background-color:white;border-radius:6px;padding:15px;margin-right:15px;">';
	body += '<div class="col-sm-12 col-md-12" style="margin-top:20px;">';
	
	$.ajax({
		contentType : 'application/json',
		url : '/api/getFriendRequests',
		dataType : 'json',
		type : 'GET',
		success : function(requests){
			requests.forEach(function(friend){

					body += '<div class="col-md-4">';
					body +=	  '<div class="panel panel-info">';
					body +=	     '<div class="panel-heading">';
					body +=	         '<h3 class="panel-title">' + friend.firstName + ' ' + friend.lastName + '</h3>';
					body +=      '</div>';
					body +=      '<div class="panel-body">';
					body +=	        '<img class="img-responsive" style="height:50px;" src=images/' + friend.profilePicture + '>';
					body +=	        '<p style="margin-top:15px;word-wrap: break-word;">' + friend.email + '</p>';
					body +=	        '<p> <small>username: </small>' + friend.username + '</p>';
					body +=	     '</div>';
					body +=      '<div class="panel-footer">';
					body +=	        '<button class="btn btn-primary" onclick="acceptFriend(' + friend.id + ')">Accept</button>';
					body +=         '<button class="btn" onclick="declineFriend(' + friend.id + ')">Decline</button>';
					body +=      '</div>'
					body +=   '</div>'
					body += '</div>'
			});

			body += '</div>';
			body += '</div>';
			body += '</div>';
			body += '<hr>';
			$("#bodyRegUser").append(body);
		},
		processData: false
		
	});

}


function acceptFriend(friendID) {

	var friendship = {};
	var primKey = {};
	primKey.userID1 = friendID;
	primKey.userID2 = friendID;
	friendship.primKey = primKey;
	friendship.actionUserID = friendID;
	friendship.status = 2;
	
	$.ajax({
		contentType : 'application/json',
		url : '/api/friendships/acceptFriendship',
		dataType : 'json',
		type : 'POST',
		data : JSON.stringify(friendship),
		success : function(data){
	    	alert("Successfully accepted friend!");
	    	//swal("Successfully accepted friend!", "Your offer is " + itemOffer.price + "$", "success");
	    	friendRequests();
		},
		error : function(data){
			alert('ERROR accepting a friend');
		},
		processData: false
		
	});	
	
}


function declineFriend(friendID) {

	var friendship = {};
	var primKey = {};
	primKey.userID1 = friendID;
	primKey.userID2 = friendID;
	friendship.primKey = primKey;
	friendship.actionUserID = friendID;
	friendship.status = 1;
	
	$.ajax({
		contentType : 'application/json',
		url : '/api/friendships/declineFriendship',
		dataType : 'json',
		type : 'POST',
		data : JSON.stringify(friendship),
		success : function(data){
	    	alert("Successfully declined friend!");
	    	friendRequests();
		},
		error : function(data){
			alert('ERROR declining a friend');
		},
		processData: false
		
	});	
	
}


function removeFriend(friendID) {

	var friendship = {};
	var primKey = {};
	primKey.userID1 = friendID;
	primKey.userID2 = friendID;
	friendship.primKey = primKey;
	friendship.actionUserID = friendID;
	friendship.status = 1;
	
	$.ajax({
		contentType : 'application/json',
		url : '/api/friendships/removeFriend',
		dataType : 'json',
		type : 'POST',
		data : JSON.stringify(friendship),
		success : function(data){
	    	alert("Successfully removed friend!");
	    	friends();
		},
		error : function(data){
			alert('ERROR removing a friend');
		},
		processData: false
		
	});	
	
}

function cinemas() {
	$("#bodyRegUser").empty();
	var body = '<div class = "row">';
	body += '';
	body += '<div class="col-sm-12 col-md-12" style="background-color:white;border-radius:6px;padding:15px;margin-right:15px;">';
	body += '<div class="col-sm-12 col-md-12" style="margin-top:20px;">';
	
	$.ajax({
		contentType : 'application/json',
		url : '/api/TheaterOrCinemas',
		dataType : 'json',
		type : 'GET',
		success : function(cinemas){
			cinemas.forEach(function(cinema){
				
				if (cinema.cinema == true) {
					body += '<div class="col-md-4">';
					body +=	  '<div class="panel panel-info">';
					body +=	     '<div class="panel-heading">';
					body +=	         '<h3 class="panel-title">' + cinema.name+ '</h3>';
					body +=      '</div>';
					body +=      '<div class="panel-body">';
					body +=           '<p>' + cinema.adress.street + '<br>';
					body +=           '<small>' + cinema.adress.city + '</small><br></p>';
					body +=           '<p>Rating: ' + cinema.averageMark + '</p>';
					body +=           '<p style="margin-top:15px;word-wrap: break-word;"><small>Description: </small>' + cinema.description + '</p>';
					body +=	     '</div>';
					body +=      '<div class="panel-footer">';
					body +=	        '<a class="btn btn-primary" style="display:inline;">Repertoar</a>';
					body +=      '</div>'
					body +=   '</div>'
					body += '</div>'	
				}
				
			});

			body += '</div>';
			body += '</div>';
			body += '</div>';
			body += '<hr>';
			$("#bodyRegUser").append(body);
		},
		processData: false
		
	});
	
}


function theaters() {
	$("#bodyRegUser").empty();
	var body = '<div class = "row">';
	body += '';
	body += '<div class="col-sm-12 col-md-12" style="background-color:white;border-radius:6px;padding:15px;margin-right:15px;">';
	body += '<div class="col-sm-12 col-md-12" style="margin-top:20px;">';
	
	$.ajax({
		contentType : 'application/json',
		url : '/api/TheaterOrCinemas',
		dataType : 'json',
		type : 'GET',
		success : function(cinemas){
			cinemas.forEach(function(cinema){
				
				if (cinema.cinema == false) {
					body += '<div class="col-md-4">';
					body +=	  '<div class="panel panel-info">';
					body +=	     '<div class="panel-heading">';
					body +=	         '<h3 class="panel-title">' + cinema.name+ '</h3>';
					body +=      '</div>';
					body +=      '<div class="panel-body">';
					body +=           '<p>' + cinema.adress.street + '<br>';
					body +=           '<small>' + cinema.adress.city + '</small><br>';
					body +=           '<small>Rating: </small>' + cinema.averageMark + '<br></p>';
					body +=           '<p style="margin-top:15px;word-wrap: break-word;"><small>Description: </small>' + cinema.description + '</p>';
					body +=	     '</div>';
					body +=      '<div class="panel-footer">';
					body +=	        '<a class="btn btn-primary" style="display:inline;">Repertoar</a>';
					body +=      '</div>'
					body +=   '</div>'
					body += '</div>'	
				}
				
			});

			body += '</div>';
			body += '</div>';
			body += '</div>';
			body += '<hr>';
			$("#bodyRegUser").append(body);
		},
		processData: false
		
	});
}



</script>
</html>